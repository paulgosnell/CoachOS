# PWA Implementation Guide

## Overview

Coach OS is now a fully installable Progressive Web App (PWA) with offline capabilities, home screen installation, and app-like experience.

## Features Implemented

### ✅ Core PWA Features
- **Installable**: Add to home screen on iOS, Android, and desktop
- **Offline Support**: Service worker caches static assets and API responses
- **App-like Experience**: Standalone mode with native look and feel
- **Fast Loading**: Comprehensive caching strategies for optimal performance
- **Background Updates**: Service worker updates automatically

### ✅ Caching Strategies

**Static Assets** (StaleWhileRevalidate)
- Images: JPG, PNG, SVG, WebP, GIF
- Fonts: WOFF, WOFF2, TTF, OTF
- Styles: CSS, LESS
- Scripts: JS files

**Dynamic Content** (NetworkFirst)
- API routes (with 10s timeout)
- Next.js data fetching
- RSC (React Server Components)
- Pages and layouts

**Media Files** (CacheFirst with Range Requests)
- Audio: MP3, WAV, OGG (for voice features)
- Video: MP4, WebM

### ✅ Configuration Files

**Manifest** (`/public/manifest.json`)
```json
{
  "name": "Coach OS - Your Business Coach In Your Pocket",
  "short_name": "Coach OS",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#0A0A0A",
  "theme_color": "#000000"
}
```

**Service Worker** (`/public/sw.js`)
- Auto-generated by @ducanh2912/next-pwa
- Precaches all Next.js build assets
- Runtime caching for dynamic content
- Automatic cleanup of outdated caches

## Installation

### For Users

**iOS (Safari)**
1. Open Coach OS in Safari
2. Tap the Share button
3. Select "Add to Home Screen"
4. Tap "Add"

**Android (Chrome)**
1. Open Coach OS in Chrome
2. Tap the three-dot menu
3. Select "Install app" or "Add to Home Screen"
4. Tap "Install"

**Desktop (Chrome, Edge, Safari)**
1. Open Coach OS
2. Look for install icon in address bar
3. Click "Install Coach OS"

### For Developers

**Package Installed**: `@ducanh2912/next-pwa@^10.2.9`

**Build Command**:
```bash
npm run build
```

Service worker is generated automatically during production build. Development mode has PWA disabled for faster iteration.

## File Structure

```
/public
├── manifest.json              # PWA manifest
├── icon.svg                   # Coach OS logo (placeholder)
├── robots.txt                 # SEO configuration
├── sw.js                      # Service worker (auto-generated)
├── workbox-*.js               # Workbox runtime (auto-generated)
├── /icons/                    # PWA icons directory
│   └── .gitkeep              # Placeholder (icons needed)
├── apple-touch-icon.png.txt   # iOS icon instructions
└── favicon.ico.txt            # Favicon instructions
```

## Icon Requirements

### Production Icons Needed

Replace placeholder files with actual branded Coach OS icons:

**Standard Sizes** (in `/public/icons/`)
- icon-72x72.png
- icon-96x96.png
- icon-128x128.png
- icon-144x144.png
- icon-152x152.png
- icon-192x192.png (maskable)
- icon-384x384.png
- icon-512x512.png (maskable)

**Special Icons** (in `/public/`)
- apple-touch-icon.png (180x180 for iOS)
- favicon.ico (multi-resolution: 16x16, 32x32, 48x48)

**Design Guidelines**:
- Background: `#0A0A0A` (titanium-950)
- Primary: `#C0C0C8` (silver)
- Accent: `#0C2340` (deep-blue)
- Maskable icons: Include 10% safe zone around key elements

**Generation Tools**:
- https://realfavicongenerator.net/ (comprehensive)
- https://www.pwabuilder.com/ (PWA-focused)
- Figma + export plugins

## Configuration

### next.config.js

```javascript
const withPWA = require('@ducanh2912/next-pwa').default({
  dest: 'public',
  disable: process.env.NODE_ENV === 'development',
  register: true,
  skipWaiting: true,
  runtimeCaching: [
    // Comprehensive caching strategies
    // See next.config.js for full configuration
  ],
})

module.exports = withPWA(nextConfig)
```

### Metadata in layout.tsx

```typescript
export const metadata: Metadata = {
  title: 'Coach OS - Your Business Coach In Your Pocket',
  manifest: '/manifest.json',
  themeColor: '#000000',
  appleWebApp: {
    capable: true,
    statusBarStyle: 'black-translucent',
    title: 'Coach OS',
  },
}
```

## Testing PWA

### Chrome DevTools Audit
1. Open DevTools (F12)
2. Go to "Lighthouse" tab
3. Select "Progressive Web App" category
4. Click "Generate report"
5. Aim for score > 90

### Installation Test
1. Build production: `npm run build`
2. Start server: `npm start`
3. Open in Chrome
4. Check for install prompt/icon

### Offline Test
1. Install the PWA
2. Open DevTools → Network tab
3. Enable "Offline" mode
4. Reload the app
5. Verify cached pages still load

### Service Worker Status
- Chrome: `chrome://serviceworker-internals/`
- Firefox: `about:serviceworkers`
- Safari: Develop → Service Workers

## Cache Management

**Automatic Cleanup**
- Outdated caches removed on service worker update
- Cache size limits enforced per strategy

**Manual Cache Clear** (for debugging)
```javascript
// In browser console
caches.keys().then(keys => {
  keys.forEach(key => caches.delete(key))
})
```

## Performance

**Cache Expiration**
- Static assets: 24 hours
- API responses: 24 hours
- Fonts: 7 days
- Next.js data: 24 hours

**Cache Limits**
- Images: 64 entries
- Scripts: 48 entries
- APIs: 16 entries
- Pages: 32 entries

## Troubleshooting

### PWA Not Installing
- Check manifest.json is accessible
- Verify HTTPS (required for PWA)
- Ensure service worker registered
- Check browser console for errors

### Stale Content After Updates
- Service worker updates on page reload
- Use `skipWaiting: true` for immediate updates
- Clear cache if needed (see Cache Management)

### iOS Not Showing Install Prompt
- iOS requires manual "Add to Home Screen"
- No automatic install prompt on iOS
- Ensure apple-touch-icon.png exists

## Future Enhancements

### Phase 7: Advanced PWA Features
- [ ] Push notifications (coach reminders)
- [ ] Background sync (offline message queue)
- [ ] Share target API (share to Coach OS)
- [ ] Badging API (unread message count)
- [ ] Periodic background sync (daily summaries)
- [ ] Web Share API (share coaching insights)

### Offline Enhancements
- [ ] Offline fallback page with cached conversations
- [ ] Local storage for draft messages
- [ ] IndexedDB for full conversation history
- [ ] Sync queue for pending messages

## Resources

- [PWA Documentation](https://web.dev/progressive-web-apps/)
- [next-pwa Package](https://github.com/DuCanhGH/next-pwa)
- [Workbox Strategies](https://developer.chrome.com/docs/workbox/modules/workbox-strategies/)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)

## Browser Compatibility

| Feature | Chrome | Safari | Firefox | Edge |
|---------|--------|--------|---------|------|
| Install | ✅ | ✅ | ✅ | ✅ |
| Offline | ✅ | ✅ | ✅ | ✅ |
| Push Notifications | ✅ | ❌ | ✅ | ✅ |
| Background Sync | ✅ | ❌ | ❌ | ✅ |

**Note**: iOS/Safari has limited PWA support compared to Android/Chrome but core features work.

---

**Status**: ✅ PWA Fully Implemented
**Build**: Tested and working
**Next Steps**: Add production icons before launch
